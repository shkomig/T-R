# Trading System Configuration
# ================================

# System Settings
system:
  name: "AI Trading System"
  version: "3.0.1"  # Updated: v3.0.1 - Bug fixes and optimizations
  timezone: "Israel"  # IST/IDT (UTC+2/+3)
  log_level: "DEBUG"  # DEBUG, INFO, WARNING, ERROR - Changed to DEBUG for troubleshooting

# Market Settings
# Note: Times are in US Eastern Time (NYSE/NASDAQ hours)
# In Israel Time: Market trades 16:30-23:00 IST/IDT (4:30 PM - 11:00 PM)
market:
  trading_hours:
    start: "09:30"  # US Market open (16:30 Israel time)
    end: "16:00"    # US Market close (23:00 Israel time)
  timeframe: "30min"  # Primary timeframe for analysis
  warmup_bars: 100    # Number of bars to load for indicator warmup

# Interactive Brokers Settings
broker:
  name: "Interactive Brokers"
  host: "127.0.0.1"
  port: 7497  # 7497 for Paper Trading, 7496 for Live Trading
  client_id: 1
  timeout: 30
  reconnect_attempts: 5
  reconnect_delay: 10  # seconds

# Strategy Settings
# OPTIMIZED 2025-11-17: Reduced to top 3 performers for quality over quantity
strategies:
  enabled:
    - "vwap"                      # Core strategy - value/trend
    - "rsi_divergence"           # 85-86% Win Rate
    - "advanced_volume_breakout" # 90% Win Rate

  disabled:  # Temporarily disabled for testing
    - "ema_cross"
    - "volume_breakout"
  
  # EMA Cross Strategy (OPTIMIZED FOR MORE SIGNALS)
  ema_cross:
    enabled: true
    fast_ema: 20        # Changed from 12 - less noise
    slow_ema: 50        # Changed from 26 - clearer trend
    signal_line: 9
    min_volume: 50000   # REDUCED: 100K -> 50K for more opportunities
    rsi_overbought: 80  # RELAXED: 75 -> 80 (less restrictive)
    rsi_oversold: 20    # RELAXED: 25 -> 20 (less restrictive)
    
  # VWAP Strategy (TESTING MODE - More permissive)
  vwap:
    enabled: true
    deviation_percent: 0.3  # TEMPORARY: Lower for more signals
    min_volume: 50000       # TEMPORARY: Lower minimum
    volume_threshold: 1.1   # TEMPORARY: Lower volume requirement
    max_distance_percent: 3.0  # TEMPORARY: Allow further entries
    min_distance_percent: 0.1  # TEMPORARY: Allow closer entries
    
  # Volume Breakout Strategy (OPTIMIZED FOR MORE SIGNALS)
  volume_breakout:
    enabled: true
    volume_threshold: 1.5      # REDUCED: 2.0 -> 1.5 (more sensitive)
    price_change_threshold: 1.5  # REDUCED: 2.0 -> 1.5 (lower threshold)
    confirmation_candles: 1    # REDUCED: 2 -> 1 (faster entry)
    min_volume: 50000          # REDUCED: 100K -> 50K
    use_atr_confirmation: true  # Additional filter
  
  # Mean Reversion Strategy Configuration
  Mean_Reversion:
    enabled: true
    
    # Z-Score parameters
    lookback_period: 21  # Days for mean and std calculation
    entry_z_score: 2.0   # Enter when Z-score crosses ±2.0
    exit_z_score: 0.5    # Exit when Z-score returns to ±0.5
    min_std: 0.001       # Minimum std deviation to avoid division by zero
    
    # Additional filters
    volume_filter: true
    min_volume: 100000   # Minimum daily volume
    trend_filter: false  # Set true to avoid trading against strong trends
    trend_period: 50     # Period for trend detection (if enabled)
    
    # Risk management
    max_holding_period: 10  # Maximum days to hold position
    stop_loss_z: 3.0        # Emergency exit if Z-score > 3.0
    
    # Position sizing
    scale_by_z_score: true  # Larger positions for stronger signals

  # Opening Range Breakout (ORB) Strategy
  ORB:
    opening_range_minutes: 30  # First 30min defines range (1 bar in our data)
    breakout_confirmation: 1   # Immediate entry on breakout
    min_range_percent: 0.2     # Lower threshold (0.2%)
    
    # Risk management
    stop_loss_atr_multiplier: 2.0  # Wider stop
    risk_reward_ratio: 2.0         # 2:1 reward:risk
    trailing_stop_percent: 2.0     # 2% trailing stop
    
    # Filters
    min_atr: 0.2              # Lower volatility threshold
    volume_filter: false      # Disable volume filter
    min_volume: 50000         # Lower min shares
    volume_threshold: 1.0     # No volume requirement

  # Momentum Strategy (Donchian Breakout)
  Momentum:
    lookback_period: 10        # Shorter lookback (10 bars)
    confirmation_bars: 0       # No confirmation needed
    
    # Risk management
    stop_loss_atr_multiplier: 3.0  # Wider stop
    trailing_stop_percent: 3.0     # 3% trailing stop
    take_profit_percent: 15.0      # 15% profit target
    
    # Filters
    min_atr: 0.2              # Lower volatility threshold
    volume_filter: false      # Disable volume filter
    min_volume: 50000         # Lower min shares
    
    # Trend filter
    use_trend_filter: false   # Disable trend filter
    trend_ma_period: 50       # Shorter MA period

  # Bollinger Bands Strategy
  Bollinger_Bands:
    period: 15                # Shorter SMA period
    num_std: 1.5              # Narrower bands (more signals)
    
    # Entry/Exit
    entry_threshold: 0.0      # % below lower band to enter
    exit_at_middle: true      # Exit at middle band
    
    # Risk management
    stop_loss_percent: 4.0    # Wider stop loss
    take_profit_at_upper: true  # Take profit at upper band
    
    # Filters
    volume_filter: false      # Disable volume filter
    min_volume: 50000         # Lower min shares
    rsi_confirmation: false   # Disable RSI confirmation
    rsi_oversold: 35          # More lenient
    rsi_overbought: 65        # More lenient
    
    # Bandwidth filter
    min_bandwidth_percent: 1.0  # Lower bandwidth threshold

  # NOTE: Mean_Reversion duplicate removed - see line 67 for main config

  # Pairs Trading Strategy (Statistical Arbitrage) - DISABLED
  # Re-enable after individual testing 
  Pairs_Trading:
    enabled: true
    pair_symbols: ['AAPL', 'MSFT']  # Trading pair (Tech giants)
    
    # Analysis windows
    lookback_window: 60         # Days for correlation analysis
    cointegration_window: 252   # 1 year for cointegration test
    
    # Trading thresholds (Z-Score based)
    entry_threshold: 2.0        # Entry when |Z-Score| >= 2.0
    exit_threshold: 0.5         # Exit when |Z-Score| <= 0.5  
    stop_loss_threshold: 3.0    # Stop loss at |Z-Score| >= 3.0
    
    # Statistical requirements
    min_correlation: 0.7        # Minimum correlation for pair
    max_pvalue: 0.05           # Max p-value for cointegration
    
    # Risk management  
    max_holding_days: 20       # Maximum holding period
    position_ratio: 1.0        # Capital allocation ratio
    
    # Performance expectations
    expected_win_rate: 0.68    # 68% win rate
    expected_sharpe: 1.8       # Sharpe ratio 1.8
    max_drawdown: 0.12         # 12% max drawdown
    
    # Risk management
    max_holding_period: 10      # Max days to hold position
    stop_loss_z: 3.0           # Stop if Z-score goes more extreme
    min_confirmations: 3        # Minimum conditions for signal

  # RSI Divergence Strategy (85-86% Win Rate) - TESTING MODE
  RSI_Divergence:
    enabled: true
    rsi_period: 14                    # RSI calculation period
    divergence_lookback: 10           # Bars to look back for divergence
    overbought: 70                    # RSI overbought level
    oversold: 30                      # RSI oversold level
    min_divergence_strength: 0.3      # TEMPORARY: Lower threshold for testing
    volume_confirmation: false        # TEMPORARY: Disable for more signals
    volume_filter: false              # TEMPORARY: Disable filter
    min_volume: 50000                 # TEMPORARY: Lower minimum
    conservative_mode: false          # TEMPORARY: More aggressive for testing

  # Advanced Volume Breakout Strategy (90% Win Rate) - TESTING MODE
  Advanced_Volume_Breakout:
    enabled: true
    lookback_period: 20               # Period for support/resistance
    volume_spike_multiplier: 1.2      # TEMPORARY: Lower for more signals
    min_breakout_percentage: 0.3      # TEMPORARY: Lower threshold
    profit_target_percentage: 3.0     # More realistic target
    stop_loss_percentage: 2.0         # 2% stop loss
    min_liquidity_volume: 50000       # TEMPORARY: Lower minimum
    volume_filter: false              # TEMPORARY: Disable filter
    confirmation_bars: 1              # Wait for confirmation

# Signal Settings (TESTING MODE - Less restrictive to see system in action)
signals:
  require_confirmation: false  # TEMPORARY: Allow single strategy signals
  min_strategies_agreement: 1  # TEMPORARY: Only 1 strategy needed
  max_signals_per_day: 10      # RESTORED: Quality over quantity

# Universe Settings (OPTIMIZED - 2025-11-17)
# Reduced from 35 to 15 high-quality, liquid stocks
universe:
  tickers:
    # TIER 1: Large Cap Tech (Most Liquid, Lower Volatility)
    - "AAPL"   # Apple - Largest liquidity
    - "MSFT"   # Microsoft - Stable growth
    - "GOOGL"  # Alphabet - Strong fundamentals
    - "AMZN"   # Amazon - E-commerce leader
    - "NVDA"   # NVIDIA - AI/Chip leader
    - "AMD"    # AMD - Chip growth
    - "TSLA"   # Tesla - EV leader (volatile but liquid)

    # TIER 2: Growth Tech (Good Liquidity, Moderate Volatility)
    - "META"   # Meta/Facebook - Social media
    - "PLTR"   # Palantir - AI/Defense
    - "SNOW"   # Snowflake - Cloud data
    - "COIN"   # Coinbase - Crypto (controlled exposure)

    # TIER 3: High Volatility (Smaller Positions Only)
    - "MSTR"   # MicroStrategy - Bitcoin proxy (limit exposure)
    - "LCID"   # Lucid Motors - EV growth
    - "RIVN"   # Rivian - EV startup

  # REMOVED for stability:
  # - GME, AMC, BYND, HOOD (meme stocks - too unpredictable)
  # - UPST, PLUG, TLRY, SOUN, IONQ (too small/volatile)
  # - RIOT, MARA (Bitcoin miners - prefer MSTR for crypto exposure)
  # - NIO, XPEV (Chinese EV - regulatory risk)
  # - AI, PATH, U, SHOP, ROKU, ZM, SOFI, DKNG (reduced universe)

  # Screener criteria (TIGHTENED - 2025-11-17)
  screener:
    min_price: 10         # Increased: Avoid penny stocks
    max_price: 1000       # Allow high-priced stocks
    min_avg_volume: 1000000  # Increased: Better liquidity (1M)
    min_market_cap: 2000000000  # Increased: $2B+ only (more stable)

# Position Management (OPTIMIZED FOR RISK CONTROL - 2025-11-17)
position:
  sizing_method: "risk_based"  # fixed, risk_based, volatility_adjusted
  max_positions: 5             # RESTORED: Better risk management
  allow_pyramiding: false
  allow_hedging: false

# Execution Settings
execution:
  order_type: "LIMIT"  # MARKET, LIMIT, STOP
  limit_price_offset: 0.1  # Percentage offset for limit orders
  time_in_force: "DAY"  # DAY, GTC, IOC, FOK
  retry_attempts: 3
  retry_delay: 5  # seconds

# Monitoring & Alerts
monitoring:
  enable_alerts: true
  alert_channels:
    - "email"
    - "telegram"
  
  # Alert conditions
  alerts:
    on_signal: true
    on_entry: true
    on_exit: true
    on_error: true
    on_risk_breach: true

# Alert System Configuration
alerts:
  email_enabled: false  # Set to true and configure credentials to enable
  telegram_enabled: false  # Set to true and configure bot to enable
  min_level: "INFO"  # Minimum alert level: INFO, WARNING, ERROR, CRITICAL
  
  # Email configuration
  email:
    smtp_server: "smtp.gmail.com"
    smtp_port: 587
    sender_email: "your-email@gmail.com"
    sender_password: "your-app-password"  # Use app-specific password
    recipients:
      - "recipient1@example.com"
      - "recipient2@example.com"
  
  # Telegram configuration
  telegram:
    bot_token: "YOUR_BOT_TOKEN"  # Get from @BotFather
    chat_ids:
      - "YOUR_CHAT_ID"  # Get from @userinfobot

# Performance Tracking
performance:
  track_metrics: true
  metrics:
    - "total_return"
    - "sharpe_ratio"
    - "sortino_ratio"
    - "max_drawdown"
    - "win_rate"
    - "profit_factor"
  
  reporting:
    daily_summary: true
    weekly_report: true
    monthly_report: true

# Backtesting Settings
backtesting:
  start_date: "2023-01-01"
  end_date: "2024-12-31"
  initial_capital: 100000
  commission: 0.001  # 0.1% per trade
  slippage: 0.0005   # 0.05% slippage
  
# Development Mode
development:
  paper_trading: true  # Start with paper trading
  debug_mode: false
  save_trade_logs: true
  verbose_logging: true
