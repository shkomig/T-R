# Risk Management Configuration
# ================================

# Account Risk Settings
account:
  initial_capital: 100000  # USD
  currency: "USD"
  
  # Maximum risk per trade
  max_risk_per_trade_percent: 2.0  # 2% of account
  max_risk_per_trade_amount: 2000  # USD
  
  # Maximum portfolio risk
  max_portfolio_risk_percent: 10.0  # 10% of account
  max_drawdown_percent: 5.0  # Maximum allowed drawdown
  
  # Daily limits
  max_daily_loss_percent: 3.0  # Stop trading if daily loss exceeds 3%
  max_daily_loss_amount: 3000  # USD

# Position Sizing
position_sizing:
  method: "risk_based"  # Options: fixed, risk_based, kelly, volatility_adjusted
  
  # Risk-based sizing
  risk_based:
    risk_per_trade: 2.0  # Percentage of account to risk per trade
    
  # Fixed sizing
  fixed:
    shares_per_trade: 100
    
  # Kelly Criterion
  kelly:
    fraction: 0.25  # Use 25% of Kelly suggestion (conservative)
    
  # Volatility adjusted
  volatility_adjusted:
    target_volatility: 0.15  # 15% annualized
    lookback_period: 20  # Days

# Stop Loss Settings (OPTIMIZED)
stop_loss:
  enabled: true
  type: "atr"  # Changed to ATR - more dynamic
  
  # Percentage-based stop
  percentage:
    stop_percent: 2.5  # INCREASED from 1% - less premature stops
    
  # ATR-based stop (NOW ACTIVE)
  atr:
    multiplier: 2.5  # INCREASED from 2.0 - wider stop
    period: 14
    
  # Fixed dollar amount
  fixed:
    amount: 500  # USD per position
    
  # Trailing stop (OPTIMIZED)
  trailing:
    enabled: true
    activation_percent: 2.0  # INCREASED from 1.5% - let it run more
    trail_percent: 1.0  # INCREASED from 0.75% - wider trail

# Take Profit Settings (OPTIMIZED)
take_profit:
  enabled: true
  type: "ratio"  # Options: ratio, percentage, fixed, target
  
  # Risk-reward ratio
  ratio:
    reward_risk_ratio: 3.0  # INCREASED from 2.0 - aim for bigger wins
    
  # Percentage-based target
  percentage:
    profit_percent: 5.0  # INCREASED from 3% - let winners run
    
  # Partial profit taking (OPTIMIZED)
  partial_exits:
    enabled: true
    levels:
      - percent: 2.5   # INCREASED from 1.5%
        exit_size: 0.25  # REDUCED from 0.33 - keep more
      - percent: 4.0   # INCREASED from 2.5%
        exit_size: 0.25  # REDUCED from 0.33
      # Remaining 50% stays until final target or stop - LET WINNERS RUN!

# Position Limits (OPTIMIZED FOR MORE TRADES)
position_limits:
  max_positions: 8  # INCREASED: 5 -> 8 (more concurrent positions)
  max_positions_per_symbol: 1
  max_position_size_percent: 15.0  # REDUCED: 20 -> 15% (spread capital more)
  max_position_size_amount: 20000  # USD

  # Sector exposure
  max_sector_exposure_percent: 30.0  # Max 30% in one sector

  # Correlation limits
  max_correlation: 0.7  # Don't take positions with correlation > 0.7

# Volatile Stock Risk Adjustments
volatile_stocks:
  # Define high volatility symbols
  high_volatility_symbols:
    # Meme stocks
    - "GME"
    - "AMC"
    - "BYND"
    - "HOOD"

    # Crypto-exposed stocks
    - "COIN"
    - "MSTR"
    - "RIOT"
    - "MARA"

    # High-beta small caps
    - "UPST"
    - "PLUG"
    - "TLRY"
    - "SOUN"
    - "IONQ"

  # Risk adjustments for volatile stocks
  risk_adjustments:
    # Reduce position size for volatile stocks
    position_size_multiplier: 0.6  # 60% of normal size
    max_risk_per_volatile_trade: 1.5  # Max 1.5% risk (vs 2% normal)

    # Stop loss adjustments
    stop_loss_multiplier: 1.5  # Wider stops (1.5x ATR vs normal)
    use_atr_stops: true  # Always use ATR for volatile stocks

    # Maximum exposure to volatile stocks
    max_volatile_exposure_percent: 30.0  # Max 30% of portfolio in volatile stocks
    max_volatile_positions: 2  # Max 2 volatile positions at once

    # Additional filters
    min_liquidity_multiplier: 2.0  # Require 2x normal volume
    require_tighter_spreads: true  # Avoid wide bid-ask spreads

    # Take profit adjustments
    take_profit_multiplier: 1.5  # Target bigger moves (1.5x normal)
    trailing_stop_activation: 3.0  # Require 3% gain before trailing

  # Symbol-specific volatility categories
  volatility_tiers:
    extreme:  # Ultra-high volatility
      symbols: ["GME", "AMC", "MSTR"]
      position_size_multiplier: 0.4  # Only 40% of normal
      max_risk_per_trade: 1.0  # Max 1% risk

    high:  # High volatility
      symbols: ["COIN", "RIOT", "MARA", "UPST", "PLUG", "TLRY"]
      position_size_multiplier: 0.6  # 60% of normal
      max_risk_per_trade: 1.5  # Max 1.5% risk

    moderate_high:  # Above average volatility
      symbols: ["NVDA", "AMD", "PLTR", "SNOW", "RIVN", "LCID"]
      position_size_multiplier: 0.8  # 80% of normal
      max_risk_per_trade: 1.8  # Max 1.8% risk

# Trading Rules
trading_rules:
  # Loss limits
  max_consecutive_losses: 4  # INCREASED: 3 -> 4 (more forgiving)
  cool_down_period: 12  # REDUCED: 24 -> 12 hours (back to trading faster)

  # Time-based rules (OPTIMIZED FOR MORE TRADES)
  no_trade_first_minutes: 5   # REDUCED: 15 -> 5 (trade earlier)
  no_trade_last_minutes: 5    # REDUCED: 15 -> 5 (trade until close)

  # Volatility rules
  max_volatility_percentile: 98  # INCREASED: 95 -> 98 (allow more volatile periods)
  min_volatility_percentile: 2   # REDUCED: 5 -> 2 (allow calmer periods)

# Drawdown Management
drawdown:
  # Drawdown levels and actions
  levels:
    - threshold: 2.0  # 2% drawdown
      action: "alert"
      
    - threshold: 3.5  # 3.5% drawdown
      action: "reduce_size"
      size_reduction: 0.5  # Reduce position size by 50%
      
    - threshold: 5.0  # 5% drawdown
      action: "stop_trading"
      cool_down_hours: 48
  
  # Recovery settings
  recovery:
    required_profit_streak: 3  # Need 3 winning trades to resume full size
    gradual_increase: true
    increase_increment: 0.25  # Increase size by 25% each winning trade

# Margin and Leverage
margin:
  use_margin: false  # Start without margin
  max_leverage: 1.0  # 1x = no leverage
  margin_call_buffer: 0.3  # Maintain 30% buffer above margin requirement

# Risk Metrics Monitoring
monitoring:
  calculate_var: true  # Value at Risk
  var_confidence: 0.95  # 95% confidence level
  var_period: 1  # 1-day VaR
  
  calculate_cvar: true  # Conditional VaR (Expected Shortfall)
  
  track_beta: true
  track_sharpe: true
  track_sortino: true
  
  # Alert thresholds
  alerts:
    sharpe_below: 0.5
    sortino_below: 0.7
    max_beta: 1.5

# Emergency Controls
emergency:
  # Kill switch - close all positions
  enable_kill_switch: true
  kill_switch_triggers:
    - type: "drawdown"
      threshold: 7.0  # 7% drawdown
    - type: "daily_loss"
      threshold: 5.0  # 5% daily loss
    - type: "manual"  # Manual trigger
  
  # Panic mode
  panic_mode:
    enabled: true
    triggers:
      - "market_crash"  # Defined as SPY down > 3% in day
      - "technical_failure"
    action: "close_all_positions"

# Review and Adjustment
review:
  # Periodic review schedule
  daily_review: true
  weekly_review: true
  monthly_review: true
  
  # Auto-adjustment
  auto_adjust_risk: true
  adjust_frequency: "weekly"
  adjustment_method: "performance_based"  # Increase risk if performing well
  max_adjustment: 0.1  # Max 10% adjustment per period
